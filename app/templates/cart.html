<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <title>Gi·ªè h√†ng</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
<div class="container py-5">
  <h2 class="mb-4">üõí Gi·ªè h√†ng c·ªßa b·∫°n</h2>

  {% if cart_items %}
    <table class="table table-bordered text-center align-middle">
      <thead class="table-dark">
        <tr>
          <th>·∫¢nh</th>
          <th>S·∫£n ph·∫©m</th>
          <th>S·ªë l∆∞·ª£ng</th>
          <th>ƒê∆°n gi√°</th>
          <th>Th√†nh ti·ªÅn</th>
          <th>Xo√°</th>
        </tr>
      </thead>
    <tbody>
  {% set ns = namespace(total=0) %}
  {% for item in cart_items %}
    {% set price = item['price'] | float %}
    {% set quantity = item['quantity'] | int %}
    {% set line_total = price * quantity %}
    {% set ns.total = ns.total + line_total %}
    <tr>
      <td><img src="{{ url_for('static', filename='images/' + item['image_url']) }}" width="80"></td>
      <td>{{ item['name'] }}</td>
      <td>
        <form method="POST" action="{{ url_for('update_cart', product_id=item['id']) }}">
          <input type="number" name="quantity" value="{{ quantity }}" min="1" class="form-control" style="width: 80px;" onchange="this.form.submit()">
        </form>
      </td>
      <td>{{ "{:,.0f}".format(price) }}‚Ç´</td>
      <td>{{ "{:,.0f}".format(line_total) }}‚Ç´</td>
      <td>
        <form method="POST" action="{{ url_for('delete_cart_item', product_id=item['id']) }}">
          <button class="btn btn-sm btn-danger" onclick="return confirm('Xo√° s·∫£n ph·∫©m n√†y?')">‚ùå</button>
        </form>
      </td>
    </tr>
  {% endfor %}
  <tr class="fw-bold text-success">
    <td colspan="4" class="text-end">T·ªïng c·ªông:</td>
    <td colspan="2" class="text-start">{{ "{:,.0f}".format(ns.total) }}‚Ç´</td>
  </tr>
</tbody>
    </table>

    <div class="text-end">
      <button class="btn btn-success btn-lg" data-bs-toggle="modal" data-bs-target="#checkoutModal">
        üì¶ ƒê·∫∑t h√†ng
      </button>
    </div>

    <div class="modal fade" id="checkoutModal" tabindex="-1" aria-labelledby="checkoutLabel" aria-hidden="true">
      <div class="modal-dialog">
        <div class="modal-content border-0 shadow">
          <form method="POST" action="/checkout">
            <div class="modal-header bg-dark text-white">
              <h5 class="modal-title" id="checkoutLabel">üßæ Th√¥ng tin ƒë·∫∑t h√†ng</h5>
              <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
              <div class="mb-3">
                <label class="form-label">H·ªç t√™n</label>
                <input type="text" name="customer_name" class="form-control" required>
              </div>
              <div class="mb-3">
                <label class="form-label">S·ªë ƒëi·ªán tho·∫°i</label>
                <input type="text" name="phone" class="form-control" required>
              </div>
              <div class="mb-3">
                <label class="form-label">ƒê·ªãa ch·ªâ</label>
                <input type="text" name="address" class="form-control" required>
              </div>
              <div class="mb-3">
                <label class="form-label">Ghi ch√∫</label>
                <textarea name="note" class="form-control" rows="2"></textarea>
              </div>
            </div>
            <div class="modal-footer">
              <button type="submit" class="btn btn-success w-100">üöÄ X√°c nh·∫≠n ƒë·∫∑t h√†ng</button>
            </div>
          </form>
        </div>
      </div>
    </div>

  {% else %}
    <div class="alert alert-warning text-center">Gi·ªè h√†ng c·ªßa b·∫°n ƒëang tr·ªëng.</div>
  {% endif %}
</div>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>