<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <title>Gi·ªè h√†ng</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>

<nav class="navbar navbar-expand-lg navbar-dark bg-dark">
  <div class="container">
    <a class="navbar-brand" href="{{ url_for('home') }}">Hwang Store</a>
  </div>
</nav>

<div class="container mt-5">
  <h2 class="mb-4">üõí Gi·ªè h√†ng c·ªßa b·∫°n</h2>

  {% if cart_items %}
  <table class="table table-bordered align-middle">
    <thead class="table-light">
      <tr>
        <th>·∫¢nh</th>
        <th>S·∫£n ph·∫©m</th>
        <th>ƒê∆°n gi√°</th>
        <th>S·ªë l∆∞·ª£ng</th>
        <th>Th√†nh ti·ªÅn</th>
        <th>Xo√°</th>
      </tr>
    </thead>
    <tbody>
      {% set total = 0 %}
      {% for item in cart_items %}
      <tr>
        <td><img src="{{ url_for('static', filename='images/' + item.image_url) }}" width="60" class="img-thumbnail"></td>
        <td>{{ item.name }}</td>
        <td>{{ item.price|currency  }}‚Ç´</td>
        <td><input type="number"
       class="form-control form-control-sm quantity-input"
       data-id="{{ item.id }}"
       value="{{ item.quantity }}"
       min="1"
       style="width: 80px;">
</td>
        <td>{{ (item.price * item.quantity)|currency }}‚Ç´</td>
        <td>
          <form action="{{ url_for('remove_from_cart', product_id=item.id) }}" method="POST">
            <button type="submit" class="btn btn-sm btn-danger">X</button>
          </form>
        </td>
      </tr>
      {% set total = total + (item.price * item.quantity) %}
      {% endfor %}
    </tbody>
    <tfoot>
  <tr>
    <td colspan="4" class="text-end"><strong>T·ªïng c·ªông:</strong></td>
    <td colspan="2"><strong>{{ total_price|currency}}‚Ç´</strong></td>
  </tr>
</tfoot>
  </table>

  <a href="{{ url_for('home') }}" class="btn btn-outline-secondary">‚Üê Ti·∫øp t·ª•c mua</a>
  <a href="/checkout-page" class="btn btn-success float-end">üßæ Thanh to√°n</a>

  {% else %}
    <div class="alert alert-warning">Gi·ªè h√†ng c·ªßa b·∫°n ƒëang tr·ªëng.</div>
  {% endif %}
</div>
<script>
document.querySelectorAll('.quantity-input').forEach(input => {
  input.addEventListener('change', function () {
    const productId = this.dataset.id;
    const quantity = this.value;

    fetch(`/update-cart/${productId}`, {
      method: 'POST',
      headers: {
        'Content-Type': 'application/x-www-form-urlencoded',
        'X-Requested-With': 'XMLHttpRequest'
      },
      body: 'quantity=' + encodeURIComponent(quantity)
    }).then(res => {
      if (res.ok) {
        // Sau khi c·∫≠p nh·∫≠t th√†nh c√¥ng, reload l·∫°i ƒë·ªÉ hi·ªÉn th·ªã t·ªïng ti·ªÅn
        location.reload();
      }
    });
  });
});
</script>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
